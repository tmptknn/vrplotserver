var express=require("express"),path=require("path"),PORT=8E3,HOST="0.0.0.0",app=express(),publicpath=path.join(__dirname,"html");app.use("/",express["static"](publicpath));app.listen(PORT,HOST);console.log("Running on http://"+HOST+":"+PORT);var WebSocketServer=require("websocket").server,http=require("http"),server=http.createServer(function(a,b){});server.listen(3773,function(){});var wsServer=new WebSocketServer({httpServer:server}),clients=[],clientId=0,maxclients=10,socket;
function sendData(a,b){for(var c=0;c<maxclients;c++)clients[c]&&c!==a&&clients[c].connection.sendUTF(b)}wsServer.on("request",function(a){a=a.accept(null,a.origin);var b=clientId;clients[b]&&(console.log("Dropping old connection "+b),clients[b].connection.close());console.log("hello "+b);clients[b]={connection:a};clientId+=1;clientId>=maxclients&&(clientId=0);a.on("message",function(a){sendData(b,a.utf8Data)});a.on("close",function(a){console.log("bye "+b);clients[b]=null})});
